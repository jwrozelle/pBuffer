% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/join_nearest.R
\name{pb_pointProbJoin}
\alias{pb_pointProbJoin}
\title{Probability-aware point-to-nearest-feature join from a density buffer}
\usage{
pb_pointProbJoin(
  point_sf,
  feature_sf,
  densityBuffer,
  templateRaster = NULL,
  point_id = "DHSID",
  feature_id = "SPAid",
  weight_name = "p",
  min_weight = 0,
  dist_quantiles = c(0.05, 0.25, 0.5, 0.75, 0.95),
  dist_breaks = seq(0, 20000, by = 250)
)
}
\arguments{
\item{point_sf}{`sf` POINT layer of displaced points (one geometry per ID).}

\item{feature_sf}{`sf` POINT layer of candidate nearest features (e.g., facilities).}

\item{densityBuffer}{A density buffer object from `pb_densityBuffer()`.}

\item{templateRaster}{Optional `RasterLayer` template for `pb_apply_densityBuffer()`.}

\item{point_id}{Unique ID in `point_sf`.}

\item{feature_id}{Unique ID in `feature_sf`.}

\item{weight_name}{Name for probability mass column (default `"p"`).}

\item{min_weight}{Drop candidate cells with weights <= min_weight.}

\item{dist_quantiles}{Numeric vector of quantiles to report (default c(.05,.25,.5,.75,.95)).}

\item{dist_breaks}{Numeric vector of distance breaks (in CRS units, typically meters)
used to build a binned probability mass distribution. If NULL, no distribution is returned.}
}
\value{
A list with:
  - `probs_long`: (point_id, feature_id, p)
  - `map_nearest`: (point_id, feature_id, p)
  - `dist_summary`: (point_id, w_mean_dist, w_median_dist, q05.., q95..)
  - `dist_distribution`: (point_id, bin_lo, bin_hi, p) if dist_breaks supplied; else NULL
}
\description{
For each displaced point, applies a `densityBuffer` to obtain a probability
surface of plausible true locations. Each candidate location deterministically
maps to a nearest feature (by Euclidean distance in the projected CRS).
We then aggregate candidate weights by feature to obtain a probability
distribution over "true nearest feature".

Also returns probability-weighted distance summaries and a lightweight
distance distribution (binned probability mass by distance).
}
