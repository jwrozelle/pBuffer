% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/join_raster.R
\name{pb_rasterValJoin}
\alias{pb_rasterValJoin}
\title{Probability-weighted raster value under positional uncertainty}
\usage{
pb_rasterValJoin(
  displaced.sf,
  inputRaster,
  densityBuffer,
  displaced.id = "DHSID",
  adminBound = NULL,
  adminID = "ID_2",
  radius_m = NULL,
  n.cores = 1
)
}
\arguments{
\item{displaced.sf}{An \code{sf} POINT object with displaced locations.}

\item{inputRaster}{A \code{raster::RasterLayer} to extract values from.}

\item{densityBuffer}{A \code{pb_densityBuffer} object (or legacy object returned by
\code{pb_Density()} / \code{pb_integratedDensity()}).}

\item{displaced.id}{Name of unique ID column in \code{displaced.sf}.}

\item{adminBound}{Optional \code{sf} polygons used to constrain weights to the polygon
containing each point.}

\item{adminID}{Admin polygon ID column name in \code{adminBound} (default "ID_2").}

\item{radius_m}{Optional scalar radius override (single-kernel mode). If NULL,
uses the largest radius available in densityBuffer.}

\item{n.cores}{Number of parallel workers (default 1). Uses \code{future.apply} if > 1.}
}
\value{
A list with:
  \itemize{
    \item \code{estimate.df}: data.frame with \code{displaced.id} and \code{estimate}
    \item \code{commVals.df}: data.frame placeholder (kept for API compatibility)
  }
}
\description{
For each displaced point, estimates the raster value at the unobserved true location
by applying a probability kernel (density buffer) centered at the displaced point and
taking a probability-weighted mean of raster cell values.
}
\details{
The kernel is provided by \code{densityBuffer}, created via \code{pb_densityBuffer()}.
The densityBuffer may be integral-based or MC-based, and may optionally include mixture
metadata (e.g., rural 99% 5km + 1% 10km). Mixture logic and optional admin trimming are
applied internally and transparently.

Missing raster values are excluded from the weighted mean; weights are implicitly
renormalized after trimming by \code{pb_apply_densityBuffer()}.
}
